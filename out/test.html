<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Pok Package Manager Specification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="w3c-status" content="[STATUS]">
  <meta name="abstract" content="[ABSTRACTATTR]">
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-LS" rel=stylesheet type="text/css">

  <style data-fill-with="stylesheet">
  </style>

</head>

<body class="h-entry">
<div class="head">
  <p data-fill-with="logo"></p>
  <h1 id="title" class="p-name no-ref">Pok Package Manager Specification</h1>
  <h2 id="subtitle" class="no-num no-toc no-ref">Living Standard,
	<span class="dt-updated"><span class="value-title" title="[CDATE]">Fri Sep 03 2021</span>
  </h2>
  <div data-fill-with="spec-metadata"></div>
  <div data-fill-with="warning"></div>
  <p class='copyright' data-fill-with='copyright'></p>
  <hr title="Separator for header">
</div>

<div class="p-summary" data-fill-with="abstract"></div>
<div data-fill-with="at-risk"></div>

<nav data-fill-with="table-of-contents" id="toc"></nav>
<main>
  <h1 id="introduction-intro">Introduction {#intro}</h1>
<p>This file contains the specification for Chroma Subsystem #15. The subsystem is responsible for managing packages, this contains downloading and searching.
This is the first draft of a standardisation effort to ensure the <strong>POK</strong> package managers longevity both as part of the Chroma operating system and outside of it as a general purpose package manager. 
The standard defines the behaviour of both the client and server side but leaves the implementation details to the programmers.
the goal of this document is to make sure the interactions between the components is properly defined and agreed upon.</p>
<h1 id="the-pok-api--api">The POK-API # {#API}</h1>
<p>The POK-API can be thought of as the version of this specification, that the server or client is conforms to. The version identifier must strictly follow <a href="https://semver.org/">Semantic Versioning 2.0.0</a>, allowing for <code>-alpha.1</code> and <code>-beta.1</code> suffixes as per the <a href="https://semver.org/#spec-item-9">Sem Ver Specification ยง9</a>.</p>
<h2 id="components--components">Components ## {#Components}</h2>
<p>The POK ecosystem is comprised of the server and the client. </p>
<h3 id="client--compclient">Client ### {#Comp/Client}</h3>
<p>The client can be any graphical or terminal application that allows the user to acquiere pckage info and payload form a server</p>
<h3 id="server--compserver">Server ### {#Comp/Server}</h3>
<p>The server is responsible for storing the package metadata and the payloads, and to serve them to the client through the POK-API.</p>
<h2 id="packages--packages">Packages ## {#Packages}</h2>
<p>A package is comprised of the following main parts:</p>
<ol>
<li>Payload that is the core of the package. This can be many things in most cases the compiled code of a program. But any file can be thought of as a package.</li>
<li>Package Metadata. this describes the package and gives extra information about it.</li>
</ol>
<p>Payloads are organized into [versions (3.2)](#3.2 Package Versions) witch </p>
<h3 id="package-metadata--packagesmeta">Package Metadata ### {#Packages/Meta}</h3>
<p>The package metadata as of this version (V1.0.0.-alpha.1) contains the following data </p>
<p>Properties:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Definition</th>
<th>Pattern</th>
</tr>
</thead>
<tbody><tr>
<td>Package ID</td>
<td>The unique ID of the package</td>
<td>[a-z0-9.]</td>
</tr>
<tr>
<td>Author</td>
<td>The author of the package</td>
<td>[A-Za-z0-9]</td>
</tr>
<tr>
<td>Name</td>
<td>The name of the package</td>
<td>[A-Za-z0-9]</td>
</tr>
<tr>
<td>Latest</td>
<td>The latest version of the package</td>
<td>version ref</td>
</tr>
</tbody></table>
<h4 id="package-id--packagesmetaid">Package ID #### {#Packages/Meta/ID}</h4>
<p>The package ID is a unique identifier for the package, and is derived form the <code>Author</code> and the <code>Name</code> metadata. The id is constructed as follows <code>&lt;Author&gt;.&lt;Name&gt;</code> for example: <code>curle.erythro</code>.
While the <code>Author</code> and <code>Name</code> fields can contain upper and lower case letters the package ID must always use their lover case variants.</p>
<h4 id="author">Author</h4>
<p>This denotes the author of the package and can use alpha numeric character, but can&#39;t contain <code>.</code>.</p>
<h4 id="name">Name</h4>
<p>This denotes the name of the package and can use alpha numeric character, but can&#39;t contain <code>.</code>.
The usage of <code>.</code> is restricted for future possibility of sub packages or indicating package relations.</p>
<h4 id="latest">Latest</h4>
<p>This denotes the version that should be downloaded by default. How this data is stored is left as an implementation detail.</p>
<h2 id="42-package-versions">4.2 Package Versions</h2>
<p>The package versions are what hold the actual payloads of the package for each version. They are identified by a Semver id.</p>
<h3 id="421-version-payload">4.2.1 Version payload</h3>
<p>The version payload can be any file that represents that programs at that version. It will be downloaded to the clients specified folder.</p>
<p>In future versions this is expected to be expanded for multiple files.</p>
<h1 id="5-the-api">5 The API</h1>
<p>The POK API is using standard http/https as the transport protocol on the port 15060 witch is currently unassigned according to <a href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.txt">iana</a>. 
Only the server must expose http endpoints for the clients to call.
Both the server and client must be able to accomodate future port changes as the port is not registerd with IANA as of the writing of this document.</p>
<h2 id="51-the-server">5.1 The Server</h2>
<p>The server is responsible for storing a database of all the packages and versions, as well as the payloads for the versions.
The server must expose the following api:</p>
<blockquote>
<p>In all the following examples <code>&lt;ADDRESS&gt;</code> notation is used for parts of a http request that can change.</p>
</blockquote>
<h3 id="511-search">5.1.1 Search</h3>
<p>The search API is composed of the following endpoint:</p>
<h4 id="get-httpaddressportsearchsearch_term">GET <code>http://&lt;ADDRESS&gt;:&lt;PORT&gt;/search/&lt;SEARCH_TERM&gt;</code></h4>
<p>The server must search it&#39;s database and try to find the best match for the <code>SEARCH_TERM</code> in the packages name and return the following data as <code>application/json</code></p>
<pre><code class="language-json">{
    &quot;name&quot;: &quot;&lt;NAME&gt;&quot;,
    &quot;author&quot;: &quot;&lt;AUTHOR&gt;&quot;,
    &quot;versions&quot;: [
      &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;
    ]
}
</code></pre>
<p>Where the <code>&lt;NAME&gt;</code> and <code>&lt;AUTHOR&gt;</code> represent the name and author metadata of the package.
The version array contains the available versions and the last item in the list denotes the version corresponding to the <code>latest</code> metadata.</p>
<p>If the server doesn&#39;t find any packages that match it should return an empty response of length 0.
If the server finds multiple matches it should return a single package in the format above.</p>
<h3 id="512-download">5.1.2 Download</h3>
<h4 id="get-httpaddressportpackage_namelatest">GET <code>http://&lt;ADDRESS&gt;:&lt;PORT&gt;/&lt;PACKAGE_NAME&gt;/latest</code></h4>
<p>The server must search the database for a exact match for <code>&lt;PACKAGE_NAME&gt;</code> and return the payload for the <code>latest</code> version as an <code>application/octet-stream</code>.</p>
<h4 id="get-httpaddressportpackage_nameversion">GET <code>http://&lt;ADDRESS&gt;:&lt;PORT&gt;/&lt;PACKAGE_NAME&gt;/&lt;VERSION&gt;</code></h4>
<p>The server must search the database for a exact match for <code>&lt;PACKAGE_NAME&gt;</code> and return the payload for the <code>&lt;VERSION&gt;</code> of the package as an <code>application/octet-stream</code>.</p>
<h2 id="52-the-client">5.2 The Client</h2>
<p>The client can be any program that is capable of communicating with the server using the API. As such we can&#39;t provide a specification that covers all clients. As general requirements the client should be able to search and download the packages.</p>
<h3 id="521-the-cli-client">5.2.1 The CLI Client</h3>
<p>We do provide a optional specification for commandline clients that describe how the API endpoints might be reflected as CLI commands.</p>
<h4 id="pok-clientexe-search-package"><code>pok-client.exe search &lt;PACKAGE&gt;</code></h4>
<p>The client uses the Search api to find the package</p>
<h4 id="pok-clientexe-package"><code>pok-client.exe &lt;PACKAGE&gt;</code></h4>
<p>The client downloads the latest version of the package</p>
<h4 id="pok-clientexe-package-version"><code>pok-client.exe &lt;PACKAGE&gt; &lt;VERSION&gt;</code></h4>
<p>The client downloads the specified version of the package</p>

</main>

