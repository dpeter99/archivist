<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.5" xml:lang="en-US">
  <compounddef id="vk_ext_memory_priority" kind="page">
    <compoundname>vk_ext_memory_priority</compoundname>
    <title>VK_EXT_memory_priority</title>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>VK_EXT_memory_priority is a device extension that allows to pass additional &quot;priority&quot; value to Vulkan memory allocations that the implementation may use prefer certain buffers and images that are critical for performance to stay in device-local memory in cases when the memory is over-subscribed, while some others may be moved to the system memory.</para>
<para>VMA offers convenient usage of this extension. If you enable it, you can pass &quot;priority&quot; parameter when creating allocations or custom pools and the library automatically passes the value to Vulkan using this extension.</para>
<para>If you want to use this extension in connection with VMA, follow these steps:</para>
<sect1 id="vk_ext_memory_priority_1vk_ext_memory_priority_initialization">
<title>Initialization</title>
<para>1) Call `vkEnumerateDeviceExtensionProperties` for the physical device. Check if the extension is supported - if returned array of `VkExtensionProperties` contains &quot;VK_EXT_memory_priority&quot;.</para>
<para>2) Call `vkGetPhysicalDeviceFeatures2` for the physical device instead of old `vkGetPhysicalDeviceFeatures`. Attach additional structure `VkPhysicalDeviceMemoryPriorityFeaturesEXT` to `VkPhysicalDeviceFeatures2::pNext` to be returned. Check if the device feature is really supported - check if `VkPhysicalDeviceMemoryPriorityFeaturesEXT::memoryPriority` is true.</para>
<para>3) While creating device with `vkCreateDevice`, enable this extension - add &quot;VK_EXT_memory_priority&quot; to the list passed as `VkDeviceCreateInfo::ppEnabledExtensionNames`.</para>
<para>4) While creating the device, also don&apos;t set `VkDeviceCreateInfo::pEnabledFeatures`. Fill in `VkPhysicalDeviceFeatures2` structure instead and pass it as `VkDeviceCreateInfo::pNext`. Enable this device feature - attach additional structure `VkPhysicalDeviceMemoryPriorityFeaturesEXT` to `VkPhysicalDeviceFeatures2::pNext` chain and set its member `memoryPriority` to `VK_TRUE`.</para>
<para>5) While creating <ref refid="struct_vma_allocator" kindref="compound">VmaAllocator</ref> with <ref refid="group__group__init_1gaf77c946fbecfcc54d02c3d1c1e7e23e7" kindref="member">vmaCreateAllocator()</ref> inform VMA that you have enabled this extension and feature - add <ref refid="group__group__init_1gga4f87c9100d154a65a4ad495f7763cf7caffdd7a5169be3dbd7cbf6b3619e4f78a" kindref="member">VMA_ALLOCATOR_CREATE_EXT_MEMORY_PRIORITY_BIT</ref> to <ref refid="struct_vma_allocator_create_info_1a392ea2ecbaff93f91a7c49f735ad4346" kindref="member">VmaAllocatorCreateInfo::flags</ref>.</para>
</sect1>
<sect1 id="vk_ext_memory_priority_1vk_ext_memory_priority_usage">
<title>Usage</title>
<para>When using this extension, you should initialize following member:</para>
<para><itemizedlist>
<listitem><para><ref refid="struct_vma_allocation_create_info_1a983d39e1a2e63649d78a960aa2fdd0f7" kindref="member">VmaAllocationCreateInfo::priority</ref> when creating a dedicated allocation with <ref refid="group__group__alloc_1ggad9889c10c798b040d59c92f257cae597a3fc311d855c2ff53f1090ef5c722b38f" kindref="member">VMA_ALLOCATION_CREATE_DEDICATED_MEMORY_BIT</ref>.</para>
</listitem><listitem><para><ref refid="struct_vma_pool_create_info_1a16e686c688f6725f119ebf6e24ab5274" kindref="member">VmaPoolCreateInfo::priority</ref> when creating a custom pool.</para>
</listitem></itemizedlist>
</para>
<para>It should be a floating-point value between `0.0f` and `1.0f`, where recommended default is `0.5f`. Memory allocated with higher value can be treated by the Vulkan implementation as higher priority and so it can have lower chances of being pushed out to system memory, experiencing degraded performance.</para>
<para>It might be a good idea to create performance-critical resources like color-attachment or depth-stencil images as dedicated and set high priority to them. For example:</para>
<para><programlisting><codeline><highlight class="normal">VkImageCreateInfo<sp/>imgCreateInfo<sp/>=<sp/>{<sp/>VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO<sp/>};</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.imageType<sp/>=<sp/>VK_IMAGE_TYPE_2D;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.extent.width<sp/>=<sp/>3840;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.extent.height<sp/>=<sp/>2160;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.extent.depth<sp/>=<sp/>1;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.mipLevels<sp/>=<sp/>1;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.arrayLayers<sp/>=<sp/>1;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.format<sp/>=<sp/>VK_FORMAT_R8G8B8A8_UNORM;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.tiling<sp/>=<sp/>VK_IMAGE_TILING_OPTIMAL;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.initialLayout<sp/>=<sp/>VK_IMAGE_LAYOUT_UNDEFINED;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.usage<sp/>=<sp/>VK_IMAGE_USAGE_SAMPLED_BIT<sp/>|<sp/>VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT;</highlight></codeline>
<codeline><highlight class="normal">imgCreateInfo.samples<sp/>=<sp/>VK_SAMPLE_COUNT_1_BIT;</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><ref refid="struct_vma_allocation_create_info" kindref="compound">VmaAllocationCreateInfo</ref><sp/>allocCreateInfo<sp/>=<sp/>{};</highlight></codeline>
<codeline><highlight class="normal">allocCreateInfo.<ref refid="struct_vma_allocation_create_info_1accb8b06b1f677d858cb9af20705fa910" kindref="member">usage</ref><sp/>=<sp/><ref refid="group__group__alloc_1ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e" kindref="member">VMA_MEMORY_USAGE_AUTO</ref>;</highlight></codeline>
<codeline><highlight class="normal">allocCreateInfo.<ref refid="struct_vma_allocation_create_info_1add09658ac14fe290ace25470ddd6d41b" kindref="member">flags</ref><sp/>=<sp/><ref refid="group__group__alloc_1ggad9889c10c798b040d59c92f257cae597a3fc311d855c2ff53f1090ef5c722b38f" kindref="member">VMA_ALLOCATION_CREATE_DEDICATED_MEMORY_BIT</ref>;</highlight></codeline>
<codeline><highlight class="normal">allocCreateInfo.<ref refid="struct_vma_allocation_create_info_1a983d39e1a2e63649d78a960aa2fdd0f7" kindref="member">priority</ref><sp/>=<sp/>1.0f;</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal">VkImage<sp/>img;</highlight></codeline>
<codeline><highlight class="normal"><ref refid="struct_vma_allocation" kindref="compound">VmaAllocation</ref><sp/>alloc;</highlight></codeline>
<codeline><highlight class="normal"><ref refid="group__group__alloc_1gaa76142ae43535c862ad9e194a6e38aaa" kindref="member">vmaCreateImage</ref>(allocator,<sp/>&amp;imgCreateInfo,<sp/>&amp;allocCreateInfo,<sp/>&amp;img,<sp/>&amp;alloc,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
</programlisting></para>
<para>`priority` member is ignored in the following situations:</para>
<para><itemizedlist>
<listitem><para>Allocations created in custom pools: They inherit the priority, along with all other allocation parameters from the parametrs passed in <ref refid="struct_vma_pool_create_info" kindref="compound">VmaPoolCreateInfo</ref> when the pool was created.</para>
</listitem><listitem><para>Allocations created in default pools: They inherit the priority from the parameters VMA used when creating default pools, which means `priority == 0.5f`. </para>
</listitem></itemizedlist>
</para>
</sect1>
    </detaileddescription>
    <location file="shadow-engine/shadow-renderer/inc/vulkan/vk_mem_alloc.h"/>
  </compounddef>
</doxygen>
